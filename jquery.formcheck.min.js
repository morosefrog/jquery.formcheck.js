/**
 * Plug-In name: jquery.formCheck.js
 * Versions: 1.1.9
 * Modify time: 2017/04/10
 * Created by TomnTang on 2016/07/18
 * Website: http://www.lovevivi.com/plugin/jquery.formcheck.js/
 */

(function(a,b){a.fn.formCheck=function(m){var g={debug:false,onBlur:true,items:{},pass:false,passSubmit:null,beforeSubmit:null,ajaxList:{},scope:false};b.formCheck={ver:"Versions: 1.1.9",time:"Modify Time: 2017/04/10"};var e={required:function(n){return(n.value=="")?false:true},empty:function(n){return(n.value=="")?true:false},text:function(o){var n=/^[0-9A-Za-z\u4E00-\u9FA5]+$/;return n.test(o.value)?true:false},number:function(o){var n=/^[0-9A-Za-z]+$/;return n.test(o.value)?true:false},digits:function(o){var n=/^[0-9]+$/;return n.test(o.value)?true:false},money:function(o){var n=/^(\d+|\d+\.\d{1,2})$/;return n.test(o.value)?true:false},email:function(o){var n=/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/;return n.test(o.value)?true:false},url:function(o){var n=/^\b(((https?|ftp):\/\/)?[-a-z0-9]+(\.[-a-z0-9]+)*\.(?:com|net|org|cn|biz|info|name|[a-z][a-z]|((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d))(:\d{4})?\b(\/[-a-z0-9_:\@&?=+,.!\/~%\$]*)?)$/i;return n.test(o.value)?true:false},icard:function(o){var n=/(^\d{15}$)|(^\d{17}(\d|x)$)/i;return n.test(o.value.toUpperCase())?true:false},mac:function(o){var n=/(^[A-F\d]{2}[A-F\d]{2}[A-F\d]{2}[A-F\d]{2}[A-F\d]{2}[A-F\d]{2}$)|(^[A-F\d]{2}(-|:)[A-F\d]{2}(-|:)[A-F\d]{2}(-|:)[A-F\d]{2}(-|:)[A-F\d]{2}(-|:)[A-F\d]{2}$)/;return n.test(o.value.toUpperCase())?true:false},ip:function(o){var n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;return n.test(o.value)?true:false},mobile:function(o){var n=/(^(\d{3,4})?(-)?\d{7,8}$)|(^1\d{10}$)/;return n.test(o.value)?true:false},chinese:function(o){var n=/^[\u4E00-\u9FA5]+$/;return n.test(o.value)?true:false},english:function(o){var n=/^[A-Za-z]+$/;return n.test(o.value)?true:false},textarea:function(o){var n=/^[0-9A-Za-z\u4E00-\u9FA5\n]+$/;return n.test(o.value)?true:false},checked:function(n){return(n.checked)?true:false},minlength:function(n){return(n.value.length>=n.minlength)?true:false},maxlength:function(n){return(n.value.length<=n.maxlength)?true:false},min:function(n){return(n.value>=n.min)?true:false},max:function(n){return(n.value<=n.max)?true:false}};var f=a.extend({},g,m),i=true,j=this.selector,c={log:function(n){f.debug&&console.log(n)},error:function(n){f.debug&&console.error(n)},info:function(n){f.debug&&console.info(n)}};var h=function(){var n=a.extend(e,f.reg);delete f.reg}();function k(q,B,o){var x={},y=(f.scope?a(""+j).find("#"+q):a("#"+q));if(!y[0]){layer.msg("id="+q+"不存在!");return i=false}x.that=y;x.id=q;x.tag=y.get(0).tagName;x.type=y.attr("type");x.value=a.trim(y.val());x.checked=y.prop("checked");x.minlength=B.minlength;x.maxlength=B.maxlength;x.min=B.min;x.max=B.max;x.verify=B.verify;x.position=B.position||2;x.error=B.error||"检测未通过";x.success=B.success||"检测通过";x.onError=B.onError||null;x.onSuccess=B.onSuccess||null;x.ajaxType=(B.ajax&&B.ajax.type)?B.ajax.type:"POST";x.ajaxURL=(B.ajax&&B.ajax.url)?B.ajax.url:"";x.callback=(B.ajax&&B.ajax.callback)?B.ajax.callback:null;x.onoff=B.onoff||null;if(x.onoff){var A,D;for(var C in x.onoff){A=C;D=x.onoff[C]}var n=k(A,D,"onoff");c.info("onoff= "+n);if(!n){i=true;return}}c.log("id= "+q+", value= "+JSON.stringify(B));for(var w=0,r=x.verify.length;w<r;w++){if(x["verify"][w]=="empty"){if(e["required"](x)){i=(x["verify"][w]=="empty")?true:e[x["verify"][w]](x);u(i);if(!i){return i}}else{return i=true}}else{i=e[x["verify"][w]](x);u(i);if(!i){return i}}}function u(E,F,G){if(!E){(o=="onsubmit"||F=="ajax")&&y[0].focus();if(o!="onoff"){if(x.callback&&F=="ajax"){c.info("======= 开始调用callback data="+G+" =======");x.callback(G,y)}else{(x.onError)?x.onError(y):layer.tips(x.error,y,{tips:x.position})}}y.addClass("error").removeClass("success");c.error("======= "+((x["verify"][w]===undefined)?"ajax":x["verify"][w])+" 未检测通过 ===========")}else{if(!f.ajaxList[q]){(x.onSuccess)?x.onSuccess(y):y.addClass("success").removeClass("error")}else{if(F=="ajax"){if(x.callback){x.callback(G,y);var H=setTimeout(function(){if(a(document.activeElement).context.type=="submit"){y.parents("form").submit();clearTimeout(H);c.log("ajax完成后，表单再次自动提交！")}},1000)}else{x.onSuccess&&x.onSuccess(y);c.log("getEvent= "+a(document.activeElement).context.type);if(a(document.activeElement).context.type=="submit"){y.parents("form").submit();c.log("ajax完成后，表单再次自动提交！")}}y.addClass("success").removeClass("error")}}}}var z=null,p=null,s=null,v={},t="";if(f.ajaxList[q]){c.log("settings.ajaxList[id]= "+JSON.stringify(f.ajaxList[q]));if(f.ajaxList[q].value!==x.value){s=layer.load(0);f.ajaxList[q].value=x.value;v[q]=x.value;c.log(v);a.ajax({type:x.ajaxType,url:x.ajaxURL,data:v,dataType:"json",success:function(E){t=E;if(E.code=="1"){z=true}else{z=false}c.log("isCallbackData= "+JSON.stringify(E));c.log("isCallback= "+z)}});p=setInterval(function(){if(z==null){c.log("ajax请求还没返回"+z)}else{if(z==false){c.log("ajax请求返回"+z);f.ajaxList[q].isCheck=z;layer.close(s);clearInterval(p);u(z,"ajax",t);return z}else{c.log("ajax请求返回ok="+z);f.ajaxList[q].isCheck=z;
    layer.close(s);clearInterval(p);u(z,"ajax",t);return z}}},500)}else{c.info("值没改变不检测，取上次结果！"+f.ajaxList[q].isCheck);i=f.ajaxList[q].isCheck;u(i);return i}}c.log("准备返回结果status="+i);if(z==null&&p!=null){i=false}return i}function l(){var n="onblur";if(f.onBlur){a.each(f.items,function(q,p){if(p.onBlur!==false){var o=(f.scope?a(""+j).find("#"+q):a("#"+q));o.on("blur",function(){k(q,p,n)})}})}else{a.each(f.items,function(q,p){if(p.onBlur===true){var o=(f.scope?a(""+j).find("#"+q):a("#"+q));o.on("blur",function(){k(q,p,n)})}})}a.each(f.items,function(t,q){var r=q.ajax?q.ajax.url:"";if(r){var p=(f.scope?a(""+j).find("#"+t):a("#"+t));var s=a.trim(p.val());if(q.ajax.check===true){s=null}var o=(s!="")?true:false;f.ajaxList[t]={value:s,isCheck:o};c.log("ajaxList= "+JSON.stringify(f.ajaxList))}})}function d(){var n="onsubmit";a.each(f.items,function(p,o){return k(p,o,n)})}return this.each(function(){l();a(this).on("submit",function(){f.beforeSubmit&&f.beforeSubmit();d();if(i){c.info("表单检测通过！");f.passSubmit&&f.passSubmit();if(f.pass){return true}}else{c.error("表单禁止提交!")}return false})})}})(jQuery,window);