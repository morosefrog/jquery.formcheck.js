/**
 * Plug-In name: jquery.formCheck.js
 * Versions: 1.2.1
 * Modify time: 2017/07/06
 * Created by TomnTang on 2016/07/18
 * Website: http://www.lovevivi.com/plugin/jquery.formcheck.js/
 */

(function(a,b){a.fn.formCheck=function(n){var g={debug:false,onBlur:true,items:{},pass:false,passSubmit:null,beforeSubmit:null,ajaxList:{},scope:false};b.formCheck={ver:"Versions: 1.2.1",time:"Modify Time: 2017/07/06",init:m};var e={required:function(o){return(o.value=="")?false:true},empty:function(o){return(o.value=="")?true:false},text:function(p){var o=/^[0-9A-Za-z\u4E00-\u9FA5]+$/;return o.test(p.value)?true:false},number:function(p){var o=/^[0-9A-Za-z]+$/;return o.test(p.value)?true:false},digits:function(p){var o=/^[0-9]+$/;return o.test(p.value)?true:false},money:function(p){var o=/^(\d+|\d+\.\d{1,2})$/;return o.test(p.value)?true:false},email:function(p){var o=/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/;return o.test(p.value)?true:false},url:function(p){var o=/^\b(((https?|ftp):\/\/)?[-a-z0-9]+(\.[-a-z0-9]+)*\.(?:com|net|org|cn|biz|info|name|[a-z][a-z]|((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d))(:\d{4})?\b(\/[-a-z0-9_:\@&?=+,.!\/~%\$]*)?)$/i;return o.test(p.value)?true:false},icard:function(p){var o=/(^\d{15}$)|(^\d{17}(\d|x)$)/i;return o.test(p.value.toUpperCase())?true:false},mac:function(p){var o=/(^[A-F\d]{2}[A-F\d]{2}[A-F\d]{2}[A-F\d]{2}[A-F\d]{2}[A-F\d]{2}$)|(^[A-F\d]{2}(-|:)[A-F\d]{2}(-|:)[A-F\d]{2}(-|:)[A-F\d]{2}(-|:)[A-F\d]{2}(-|:)[A-F\d]{2}$)/;return o.test(p.value.toUpperCase())?true:false},ip:function(p){var o=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;return o.test(p.value)?true:false},mobile:function(p){var o=/(^(\d{3,4})?(-)?\d{7,8}$)|(^1\d{10}$)/;return o.test(p.value)?true:false},chinese:function(p){var o=/^[\u4E00-\u9FA5]+$/;return o.test(p.value)?true:false},english:function(p){var o=/^[A-Za-z]+$/;return o.test(p.value)?true:false},textarea:function(p){var o=/^[0-9A-Za-z\u4E00-\u9FA5\n]+$/;return o.test(p.value)?true:false},checked:function(o){return(o.checked)?true:false},minlength:function(o){return(o.value.length>=o.minlength)?true:false},maxlength:function(o){return(o.value.length<=o.maxlength)?true:false},min:function(o){return(o.value>=o.min)?true:false},max:function(o){return(o.value<=o.max)?true:false}};var f=a.extend({},g,n),i=true,k=false,j=this.selector,c={log:function(o){f.debug&&console.log(o)},error:function(o){f.debug&&console.error(o)},info:function(o){f.debug&&console.info(o)}};var h=function(){var o=a.extend(e,f.reg);delete f.reg}();function l(r,C,p){var y={},z=(f.scope?a(""+j).find("#"+r):a("#"+r));if(!z[0]){layer.msg("id="+r+"不存在!");return i=false}c.log("event= "+p);if(p=="onblur"&&k){return}else{if(p=="onsubmit"){k=true}}y.that=z;y.id=r;y.tag=z.get(0).tagName;y.type=z.attr("type");y.value=a.trim(z.val());y.checked=z.prop("checked");y.minlength=C.minlength;y.maxlength=C.maxlength;y.min=C.min;y.max=C.max;y.verify=C.verify;y.position=C.position||2;y.error=C.error||"检测未通过";y.success=C.success||"检测通过";y.onError=C.onError||null;y.onSuccess=C.onSuccess||null;y.ajaxType=(C.ajax&&C.ajax.type)?C.ajax.type:"POST";y.ajaxURL=(C.ajax&&C.ajax.url)?C.ajax.url:"";y.callback=(C.ajax&&C.ajax.callback)?C.ajax.callback:null;y.onoff=C.onoff||null;if(y.onoff){var B,E;for(var D in y.onoff){B=D;E=y.onoff[D]}var o=l(B,E,"onoff");c.info("onoff= "+o);if(!o){return i=true}}c.log("id= "+r+", value= "+JSON.stringify(C));for(var x=0,s=y.verify.length;x<s;x++){if(y["verify"][x]=="empty"){if(e["required"](y)){i=(y["verify"][x]=="empty")?true:e[y["verify"][x]](y);v(i);if(!i){return i}}else{return i=true}}else{i=e[y["verify"][x]](y);v(i);if(!i){return i}}}function v(F,G,H){if(!F){(p=="onsubmit"||G=="ajax")&&z[0].focus();if(p!="onoff"){if(y.callback&&G=="ajax"){c.info("======= 开始调用callback data="+H+" =======");y.callback(H,z)}else{(y.onError)?y.onError(z):layer.tips(y.error,z,{tips:y.position})}}z.addClass("error").removeClass("success");k=false;c.error("======= "+((y["verify"][x]===undefined)?"ajax":y["verify"][x])+" 未检测通过 ===========")}else{if(!f.ajaxList[r]){(y.onSuccess)?y.onSuccess(z):z.addClass("success").removeClass("error")}else{if(G=="ajax"){if(y.callback){y.callback(H,z);var I=setTimeout(function(){if(a(document.activeElement).context.type=="submit"){z.parents("form").submit();clearTimeout(I);c.log("ajax完成后，表单再次自动提交！")}},1000)}else{y.onSuccess&&y.onSuccess(z);c.log("getEvent= "+a(document.activeElement).context.type);if(a(document.activeElement).context.type=="submit"){z.parents("form").submit();c.log("ajax完成后，表单再次自动提交！")}}z.addClass("success").removeClass("error")}}}}var A=null,q=null,t=null,w={},u="";if(f.ajaxList[r]){c.log("settings.ajaxList[id]= "+JSON.stringify(f.ajaxList[r]));if(f.ajaxList[r].value!==y.value){t=layer.load(0);f.ajaxList[r].value=y.value;w[r]=y.value;c.log(w);a.ajax({type:y.ajaxType,url:y.ajaxURL,data:w,dataType:"json",success:function(F){u=F;if(F.code=="1"){A=true}else{A=false}c.log("isCallbackData= "+JSON.stringify(F));c.log("isCallback= "+A)}});q=setInterval(function(){if(A==null){c.log("ajax请求还没返回"+A)}else{if(A==false){c.log("ajax请求返回"+A);f.ajaxList[r].isCheck=A;layer.close(t);
    clearInterval(q);v(A,"ajax",u);return A}else{c.log("ajax请求返回ok="+A);f.ajaxList[r].isCheck=A;layer.close(t);clearInterval(q);v(A,"ajax",u);return A}}},500)}else{c.info("值没改变不检测，取上次结果！"+f.ajaxList[r].isCheck);i=f.ajaxList[r].isCheck;v(i);return i}}c.log(p+"=>准备返回结果status="+i);if(A==null&&q!=null){i=false}return i}function m(){var o="onblur";a.each(f.items,function(r,q){var p=(f.scope?a(""+j).find("#"+r):a("#"+r));p.off("blur")});if(f.onBlur){a.each(f.items,function(r,q){if(q.onBlur!==false){var p=(f.scope?a(""+j).find("#"+r):a("#"+r));p.on("blur",function(){l(r,q,o)})}})}else{a.each(f.items,function(r,q){if(q.onBlur===true){var p=(f.scope?a(""+j).find("#"+r):a("#"+r));p.on("blur",function(){l(r,q,o)})}})}a.each(f.items,function(u,r){var s=r.ajax?r.ajax.url:"";if(s){var q=(f.scope?a(""+j).find("#"+u):a("#"+u));var t=a.trim(q.val());if(r.ajax.check===true){t=null}var p=(t!="")?true:false;f.ajaxList[u]={value:t,isCheck:p};c.log("ajaxList= "+JSON.stringify(f.ajaxList))}})}function d(){var o="onsubmit";a.each(f.items,function(q,p){return l(q,p,o)})}return this.each(function(){m();a(this).on("submit",function(){f.beforeSubmit&&f.beforeSubmit();d();if(i){c.info("表单检测通过！");f.passSubmit&&f.passSubmit();if(f.pass){return true}}else{c.error("表单禁止提交!")}return false})})}})(jQuery,window);