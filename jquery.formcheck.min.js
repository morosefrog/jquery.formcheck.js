/**
 * Plug-In name: jquery.formCheck.js
 * Versions: 1.1.7
 * Modify time: 2017/03/26
 * Created by TomnTang on 2016/07/18
 * Website: http://www.lovevivi.com/plugin/jquery.formcheck.js/
 */

(function(a,b){a.fn.formCheck=function(l){var g={debug:false,onBlur:true,items:{},pass:false,passSubmit:null,beforeSubmit:null,ajaxList:{}};b.formCheck={ver:"Versions: 1.1.7",time:"Modify Time: 2017/03/26"};var e={required:function(m){return(m.value=="")?false:true},empty:function(m){return(m.value=="")?true:false},text:function(n){var m=/^[0-9A-Za-z\u4E00-\u9FA5]+$/;return m.test(n.value)?true:false},number:function(n){var m=/^[0-9A-Za-z]+$/;return m.test(n.value)?true:false},digits:function(n){var m=/^[0-9]+$/;return m.test(n.value)?true:false},money:function(n){var m=/^(\d+|\d+\.\d{1,2})$/;return m.test(n.value)?true:false},email:function(n){var m=/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/;return m.test(n.value)?true:false},url:function(n){var m=/^\b(((https?|ftp):\/\/)?[-a-z0-9]+(\.[-a-z0-9]+)*\.(?:com|net|org|cn|biz|info|name|[a-z][a-z]|((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d))(:\d{4})?\b(\/[-a-z0-9_:\@&?=+,.!\/~%\$]*)?)$/i;return m.test(n.value)?true:false},icard:function(n){var m=/(^\d{15}$)|(^\d{17}(\d|x)$)/i;return m.test(n.value.toUpperCase())?true:false},mac:function(n){var m=/(^[A-F\d]{2}[A-F\d]{2}[A-F\d]{2}[A-F\d]{2}[A-F\d]{2}[A-F\d]{2}$)|(^[A-F\d]{2}(-|:)[A-F\d]{2}(-|:)[A-F\d]{2}(-|:)[A-F\d]{2}(-|:)[A-F\d]{2}(-|:)[A-F\d]{2}$)/;return m.test(n.value.toUpperCase())?true:false},ip:function(n){var m=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;return m.test(n.value)?true:false},mobile:function(n){var m=/(^(\d{3,4})?(-)?\d{7,8}$)|(^1\d{10}$)/;return m.test(n.value)?true:false},chinese:function(n){var m=/^[\u4E00-\u9FA5]+$/;return m.test(n.value)?true:false},english:function(n){var m=/^[A-Za-z]+$/;return m.test(n.value)?true:false},textarea:function(n){var m=/^[0-9A-Za-z\u4E00-\u9FA5\n]+$/;return m.test(n.value)?true:false},checked:function(m){return(m.checked)?true:false},minlength:function(m){return(m.value.length>=m.minlength)?true:false},maxlength:function(m){return(m.value.length<=m.maxlength)?true:false},min:function(m){return(m.value>=m.min)?true:false},max:function(m){return(m.value<=m.max)?true:false}};var f=a.extend({},g,l),i=true,c={log:function(m){f.debug&&console.log(m)},error:function(m){f.debug&&console.error(m)},info:function(m){f.debug&&console.info(m)}};var h=function(){var m=a.extend(e,f.reg);delete f.reg}();function j(p,A,n){var w={},x=a("#"+p);if(!x[0]){layer.msg("id="+p+"不存在!");return i=false}w.that=x;w.id=p;w.tag=x.get(0).tagName;w.type=x.attr("type");w.value=a.trim(x.val());w.checked=x.prop("checked");w.minlength=A.minlength;w.maxlength=A.maxlength;w.min=A.min;w.max=A.max;w.verify=A.verify;w.position=A.position||2;w.error=A.error||"检测未通过";w.success=A.success||"检测通过";w.onError=A.onError||null;w.onSuccess=A.onSuccess||null;w.ajaxType=(A.ajax&&A.ajax.type)?A.ajax.type:"POST";w.ajaxURL=(A.ajax&&A.ajax.url)?A.ajax.url:"";w.callback=(A.ajax&&A.ajax.callback)?A.ajax.callback:null;w.onoff=A.onoff||null;if(w.onoff){var z,C;for(var B in w.onoff){z=B;C=w.onoff[B]}var m=j(z,C,"onoff");c.info("onoff= "+m);if(!m){i=true;return}}c.log("id= "+p+", value= "+JSON.stringify(A));for(var v=0,q=w.verify.length;v<q;v++){if(w["verify"][v]=="empty"){if(e["required"](w)){i=(w["verify"][v]=="empty")?true:e[w["verify"][v]](w);t(i);if(!i){return i}}else{return i=true}}else{i=e[w["verify"][v]](w);t(i);if(!i){return i}}}function t(D,E,F){if(!D){(n=="onsubmit"||E=="ajax")&&x[0].focus();if(n!="onoff"){if(w.callback&&E=="ajax"){c.info("======= 开始调用callback data="+F+" =======");w.callback(F,x)}else{(w.onError)?w.onError(x):layer.tips(w.error,x,{tips:w.position})}}x.addClass("error").removeClass("success");c.error("======= "+((w["verify"][v]===undefined)?"ajax":w["verify"][v])+" 未检测通过 ===========")}else{if(!f.ajaxList[p]){(w.onSuccess)?w.onSuccess(x):x.addClass("success").removeClass("error")}else{if(E=="ajax"){if(w.callback){w.callback(F,x);var G=setTimeout(function(){if(a(document.activeElement).context.type=="submit"){x.parents("form").submit();clearTimeout(G)}},1000)}else{w.onSuccess&&w.onSuccess(x);c.log("getEvent= "+a(document.activeElement).context.type);if(a(document.activeElement).context.type=="submit"){x.parents("form").submit()}}x.addClass("success").removeClass("error");c.log("ajax完成后，表单再次自动提交！")}}}}var y=null,o=null,r=null,u={},s="";if(f.ajaxList[p]){c.log("settings.ajaxList[id]= "+JSON.stringify(f.ajaxList[p]));if(f.ajaxList[p].value!==w.value){r=layer.load(0);f.ajaxList[p].value=w.value;u[p]=w.value;c.log(u);a.ajax({type:w.ajaxType,url:w.ajaxURL,data:u,dataType:"json",success:function(D){s=D;if(D.code=="1"){y=true}else{y=false}c.log("isCallbackData= "+JSON.stringify(D));c.log("isCallback= "+y)}});o=setInterval(function(){if(y==null){c.log("ajax请求还没返回"+y)}else{if(y==false){c.log("ajax请求返回"+y);f.ajaxList[p].isCheck=y;layer.close(r);clearInterval(o);t(y,"ajax",s);return y}else{c.log("ajax请求返回ok="+y);f.ajaxList[p].isCheck=y;layer.close(r);clearInterval(o);t(y,"ajax",s);return y}}},500)}else{c.info("值没改变不检测，取上次结果！"+f.ajaxList[p].isCheck);
    i=f.ajaxList[p].isCheck;t(i);return i}}c.log("准备返回结果status="+i);return i}function k(){var m="onblur";if(f.onBlur){a.each(f.items,function(o,n){if(n.onBlur!==false){a("#"+o).on("blur",function(){j(o,n,m)})}})}else{a.each(f.items,function(o,n){if(n.onBlur===true){a("#"+o).on("blur",function(){j(o,n,m)})}})}a.each(f.items,function(r,o){var p=o.ajax?o.ajax.url:"";if(p){var q=a.trim(a("#"+r).val());var n=(q!="")?true:false;f.ajaxList[r]={value:q,isCheck:n};c.log("ajaxList= "+JSON.stringify(f.ajaxList))}})}function d(){var m="onsubmit";a.each(f.items,function(o,n){return j(o,n,m)})}return this.each(function(){k();a(this).on("submit",function(){f.beforeSubmit&&f.beforeSubmit();d();if(i){c.info("表单检测通过！");f.passSubmit&&f.passSubmit();if(f.pass){return true}}else{c.error("表单禁止提交!")}return false})})}})(jQuery,window);